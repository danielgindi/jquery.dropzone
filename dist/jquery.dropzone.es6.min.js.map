{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["'use strict';\r\n\r\nimport jQuery from 'jquery';\r\n\r\nconst $ = jQuery;\r\n\r\n/**\r\n * @typedef {Object} DropZone~Options\r\n * @property {String|jQuery|undefined|null} [append=null] - jQuery expression/element to append to the dropzone\r\n * @property {function(dataTransfer):Boolean} [allowDrop] - A function that determines whether we allow dropping or not\r\n */\r\n\r\n/** @type {DropZone~Options} */\r\nlet defaultOptions = {\r\n    append: null,\r\n};\r\n\r\nclass DropZone {\r\n    /**\r\n     * @param {Element} el\r\n     * @param {DropZone~Options} options\r\n     */\r\n    constructor(el, options) {\r\n        /** @type {DropZone~Options} */\r\n        this.options = $.extend({}, defaultOptions, options);\r\n\r\n        let globalDragCounter = 0,\r\n            innerDragCounter = 0;\r\n\r\n        let $dropZone = this.$el = $(el);\r\n        let $dropZoneAppend = options.append ? $(options.append) : null;\r\n\r\n        // For jQuery.UI or jquery.removeevent\r\n        this.$el.on('remove', () => {\r\n            this.destroy();\r\n        });\r\n        \r\n        let innerDragOver, innerDragEnter, innerDragLeave, innerDragDrop, startGlobalDrag, allowGlobalDrag, endGlobalDrag, globalDrop;\r\n\r\n        innerDragOver = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) return;\r\n                \r\n            event.preventDefault();\r\n        };\r\n\r\n        innerDragEnter = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) {\r\n                event.preventDefault();\r\n                return;\r\n            }\r\n\r\n            if (typeof event !== 'undefined') {\r\n                innerDragCounter++;\r\n                if (innerDragCounter !== 1) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            $dropZone.addClass('drop-over');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.addClass('drop-over');\r\n            }\r\n        };\r\n\r\n        innerDragLeave = function () {\r\n            if (typeof event !== 'undefined') {\r\n                innerDragCounter = Math.max(innerDragCounter - 1, 0);\r\n                if (innerDragCounter > 0) {\r\n                    return;\r\n                }\r\n            } else {\r\n                innerDragCounter = 0;\r\n            }\r\n\r\n            $dropZone.removeClass('drop-over');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.removeClass('drop-over');\r\n            }\r\n        };\r\n\r\n        innerDragDrop = function () {\r\n            endGlobalDrag();\r\n        };\r\n\r\n        startGlobalDrag = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) {\r\n                event.preventDefault();\r\n                return;\r\n            }\r\n\r\n            if (typeof event !== 'undefined') {\r\n                globalDragCounter++;\r\n                if (globalDragCounter !== 1) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            $dropZone.addClass('drop-available');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.appendTo($dropZone);\r\n            }\r\n\r\n            ($dropZoneAppend || $dropZone)\r\n                .on('dragover', innerDragOver)\r\n                .on('dragenter', innerDragEnter)\r\n                .on('dragleave', innerDragLeave)\r\n                .on('drop', innerDragDrop);\r\n        };\r\n\r\n        allowGlobalDrag = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) return;\r\n\r\n            event.preventDefault();\r\n        };\r\n\r\n        endGlobalDrag = function (event) {\r\n            if (typeof event !== 'undefined') {\r\n                globalDragCounter = Math.max(globalDragCounter - 1, 0);\r\n                if (globalDragCounter > 0) {\r\n                    return;\r\n                }\r\n            } else {\r\n                globalDragCounter = 0;\r\n            }\r\n\r\n            $dropZone.removeClass('drop-available');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.detach();\r\n            }\r\n\r\n            ($dropZoneAppend || $dropZone)\r\n                .off('dragover', innerDragOver)\r\n                .off('dragenter', innerDragEnter)\r\n                .off('dragleave', innerDragLeave)\r\n                .off('drop', innerDragDrop);\r\n\r\n            innerDragLeave();\r\n        };\r\n\r\n        globalDrop = function (_event) {\r\n            setTimeout(() => {\r\n                endGlobalDrag();\r\n            }, 0);\r\n        };\r\n\r\n        $(window)\r\n            .on('dragover', allowGlobalDrag)\r\n            .on('dragenter', startGlobalDrag)\r\n            .on('dragleave', endGlobalDrag)\r\n            .on('drop', globalDrop);\r\n\r\n        $dropZone.data('global-dropzone', {\r\n            allowGlobalDrag: allowGlobalDrag,\r\n            startGlobalDrag: startGlobalDrag,\r\n            endGlobalDrag: endGlobalDrag,\r\n            globalDrop: globalDrop,\r\n        });\r\n    }\r\n\r\n    destroy() {\r\n\r\n        if (!this.$el) return;\r\n\r\n        let $dropZone = this.$el;\r\n        let dropData = $dropZone.data('global-dropzone');\r\n\r\n        if (dropData) {\r\n            $(window)\r\n                .off('dragover', dropData.allowGlobalDrag)\r\n                .off('dragenter', dropData.startGlobalDrag)\r\n                .off('dragleave', dropData.endGlobalDrag)\r\n                .off('drop', dropData.globalDrop);\r\n            dropData.endGlobalDrag();\r\n            $dropZone.removeData('global-dropzone');\r\n        }\r\n\r\n        if ($dropZone.data('dropzone') == this) {\r\n            $dropZone.removeData('dropzone');\r\n        }\r\n\r\n        this.options = null;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @param {DropZone~Options|String} options - Options for constructing the DropZone, or name of function to call\r\n * @returns {$}\r\n */\r\n$.fn.dropzone = function (options) {\r\n    let args = arguments;\r\n\r\n    let returnValues;\r\n\r\n    this.each(function (eachIndex) {\r\n        let $this = $(this)\r\n            , obj = $this.data('dropzone');\r\n\r\n        if (typeof args[0] === 'string') {\r\n            if (obj && typeof obj[args[0]] === 'function') {\r\n\r\n                // Call the method\r\n                let returnValue = obj[args[0]].apply(obj, Array.prototype.slice.call(args, 1));\r\n                if (returnValue === obj) { // If a method is chaining\r\n                    returnValue = undefined;\r\n                }\r\n                if (returnValue !== undefined) {\r\n                    returnValues = returnValues || [];\r\n                    returnValues[eachIndex] = returnValue;\r\n                }\r\n\r\n                return; // Nothing further to do\r\n\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (obj) {\r\n            try {\r\n                obj.destroy();\r\n            } catch (ignored) {\r\n                // Nothing to do here\r\n            }\r\n        }\r\n\r\n        options = /** @type {DropZone~Options} */ $.extend({}, options || {});\r\n        obj = new DropZone(this, options);\r\n        $this.data('dropzone', obj);\r\n    });\r\n\r\n    return returnValues\r\n        ? (returnValues.length === 1 ? returnValues[0] : returnValues)\r\n        : this;\r\n};\r\n\r\nexport default DropZone;"],"names":["$","jQuery","defaultOptions","append","DropZone","constructor","el","options","extend","innerDragOver","innerDragEnter","innerDragLeave","innerDragDrop","startGlobalDrag","allowGlobalDrag","endGlobalDrag","globalDrop","globalDragCounter","innerDragCounter","$dropZone","this","$el","$dropZoneAppend","on","destroy","event","allowDrop","originalEvent","dataTransfer","preventDefault","addClass","Math","max","removeClass","appendTo","detach","off","_event","setTimeout","window","data","dropData","removeData","fn","dropzone","returnValues","args","arguments","each","eachIndex","$this","obj","ignored","returnValue","apply","Array","prototype","slice","call","undefined","length"],"mappings":"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"}