{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["'use strict';\r\n\r\nimport jQuery from 'jquery';\r\n\r\nconst $ = jQuery;\r\n\r\n/**\r\n * @typedef {Object} DropZone~Options\r\n * @property {String|jQuery|undefined|null} [append=null] - jQuery expression/element to append to the dropzone\r\n * @property {function(dataTransfer):Boolean} [allowDrop] - A function that determines whether we allow dropping or not\r\n */\r\n\r\n/** @type {DropZone~Options} */\r\nlet defaultOptions = {\r\n    append: null,\r\n};\r\n\r\nclass DropZone {\r\n    /**\r\n     * @param {Element} el\r\n     * @param {DropZone~Options} options\r\n     */\r\n    constructor(el, options) {\r\n        /** @type {DropZone~Options} */\r\n        this.options = $.extend({}, defaultOptions, options);\r\n\r\n        let globalDragCounter = 0,\r\n            innerDragCounter = 0;\r\n\r\n        let $dropZone = this.$el = $(el);\r\n        let $dropZoneAppend = options.append ? $(options.append) : null;\r\n\r\n        // For jQuery.UI or jquery.removeevent\r\n        this.$el.on('remove', () => {\r\n            this.destroy();\r\n        });\r\n        \r\n        let innerDragOver, innerDragEnter, innerDragLeave, innerDragDrop, startGlobalDrag, allowGlobalDrag, endGlobalDrag, globalDrop;\r\n\r\n        innerDragOver = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) return;\r\n                \r\n            event.preventDefault();\r\n        };\r\n\r\n        innerDragEnter = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) {\r\n                event.preventDefault();\r\n                return;\r\n            }\r\n\r\n            if (typeof event !== 'undefined') {\r\n                innerDragCounter++;\r\n                if (innerDragCounter !== 1) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            $dropZone.addClass('drop-over');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.addClass('drop-over');\r\n            }\r\n        };\r\n\r\n        innerDragLeave = function () {\r\n            if (typeof event !== 'undefined') {\r\n                innerDragCounter = Math.max(innerDragCounter - 1, 0);\r\n                if (innerDragCounter > 0) {\r\n                    return;\r\n                }\r\n            } else {\r\n                innerDragCounter = 0;\r\n            }\r\n\r\n            $dropZone.removeClass('drop-over');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.removeClass('drop-over');\r\n            }\r\n        };\r\n\r\n        innerDragDrop = function () {\r\n            endGlobalDrag();\r\n        };\r\n\r\n        startGlobalDrag = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) {\r\n                event.preventDefault();\r\n                return;\r\n            }\r\n\r\n            if (typeof event !== 'undefined') {\r\n                globalDragCounter++;\r\n                if (globalDragCounter !== 1) {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            $dropZone.addClass('drop-available');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.appendTo($dropZone);\r\n            }\r\n\r\n            ($dropZoneAppend || $dropZone)\r\n                .on('dragover', innerDragOver)\r\n                .on('dragenter', innerDragEnter)\r\n                .on('dragleave', innerDragLeave)\r\n                .on('drop', innerDragDrop);\r\n        };\r\n\r\n        allowGlobalDrag = function (event) {\r\n            if (typeof options.allowDrop === 'function' \r\n                && !options.allowDrop(event.originalEvent.dataTransfer)) return;\r\n\r\n            event.preventDefault();\r\n        };\r\n\r\n        endGlobalDrag = function (event) {\r\n            if (typeof event !== 'undefined') {\r\n                globalDragCounter = Math.max(globalDragCounter - 1, 0);\r\n                if (globalDragCounter > 0) {\r\n                    return;\r\n                }\r\n            } else {\r\n                globalDragCounter = 0;\r\n            }\r\n\r\n            $dropZone.removeClass('drop-available');\r\n\r\n            if ($dropZoneAppend) {\r\n                $dropZoneAppend.detach();\r\n            }\r\n\r\n            ($dropZoneAppend || $dropZone)\r\n                .off('dragover', innerDragOver)\r\n                .off('dragenter', innerDragEnter)\r\n                .off('dragleave', innerDragLeave)\r\n                .off('drop', innerDragDrop);\r\n\r\n            innerDragLeave();\r\n        };\r\n\r\n        globalDrop = function (_event) {\r\n            setTimeout(() => {\r\n                endGlobalDrag();\r\n            }, 0);\r\n        };\r\n\r\n        $(window)\r\n            .on('dragover', allowGlobalDrag)\r\n            .on('dragenter', startGlobalDrag)\r\n            .on('dragleave', endGlobalDrag)\r\n            .on('drop', globalDrop);\r\n\r\n        $dropZone.data('global-dropzone', {\r\n            allowGlobalDrag: allowGlobalDrag,\r\n            startGlobalDrag: startGlobalDrag,\r\n            endGlobalDrag: endGlobalDrag,\r\n            globalDrop: globalDrop,\r\n        });\r\n    }\r\n\r\n    destroy() {\r\n\r\n        if (!this.$el) return;\r\n\r\n        let $dropZone = this.$el;\r\n        let dropData = $dropZone.data('global-dropzone');\r\n\r\n        if (dropData) {\r\n            $(window)\r\n                .off('dragover', dropData.allowGlobalDrag)\r\n                .off('dragenter', dropData.startGlobalDrag)\r\n                .off('dragleave', dropData.endGlobalDrag)\r\n                .off('drop', dropData.globalDrop);\r\n            dropData.endGlobalDrag();\r\n            $dropZone.removeData('global-dropzone');\r\n        }\r\n\r\n        if ($dropZone.data('dropzone') == this) {\r\n            $dropZone.removeData('dropzone');\r\n        }\r\n\r\n        this.options = null;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @param {DropZone~Options|String} options - Options for constructing the DropZone, or name of function to call\r\n * @returns {$}\r\n */\r\n$.fn.dropzone = function (options) {\r\n    let args = arguments;\r\n\r\n    let returnValues;\r\n\r\n    this.each(function (eachIndex) {\r\n        let $this = $(this)\r\n            , obj = $this.data('dropzone');\r\n\r\n        if (typeof args[0] === 'string') {\r\n            if (obj && typeof obj[args[0]] === 'function') {\r\n\r\n                // Call the method\r\n                let returnValue = obj[args[0]].apply(obj, Array.prototype.slice.call(args, 1));\r\n                if (returnValue === obj) { // If a method is chaining\r\n                    returnValue = undefined;\r\n                }\r\n                if (returnValue !== undefined) {\r\n                    returnValues = returnValues || [];\r\n                    returnValues[eachIndex] = returnValue;\r\n                }\r\n\r\n                return; // Nothing further to do\r\n\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (obj) {\r\n            try {\r\n                obj.destroy();\r\n            } catch (ignored) {\r\n                // Nothing to do here\r\n            }\r\n        }\r\n\r\n        options = /** @type {DropZone~Options} */ $.extend({}, options || {});\r\n        obj = new DropZone(this, options);\r\n        $this.data('dropzone', obj);\r\n    });\r\n\r\n    return returnValues\r\n        ? (returnValues.length === 1 ? returnValues[0] : returnValues)\r\n        : this;\r\n};\r\n\r\nexport default DropZone;"],"names":["$","jQuery","defaultOptions","append","DropZone","constructor","el","options","extend","globalDragCounter","innerDragCounter","$dropZone","$el","$dropZoneAppend","on","destroy","innerDragOver","innerDragEnter","innerDragLeave","innerDragDrop","startGlobalDrag","allowGlobalDrag","endGlobalDrag","globalDrop","event","allowDrop","originalEvent","dataTransfer","preventDefault","addClass","Math","max","removeClass","appendTo","detach","off","_event","setTimeout","window","data","dropData","removeData","fn","dropzone","args","arguments","returnValues","each","eachIndex","$this","obj","returnValue","apply","Array","prototype","slice","call","undefined","ignored","length"],"mappings":"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"}